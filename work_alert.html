<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê³¼ì œ ê³µì§€</title>
<link rel="stylesheet" href="./common.css">
<style>
  body {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
  }
  
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  
  #teacherBox {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  
  #teacherBox h3 {
    margin-top: 0;
    color: #333;
  }
  
  #teacherBox input {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 2px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
  }
  
  #teacherBox button {
    width: 100%;
    padding: 12px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
  }
  
  #teacherBox button:hover {
    background: #45a049;
  }
  
  .notice {
    background: white;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 10px;
    border-left: 4px solid #667eea;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  
  .notice h3 {
    margin-top: 0;
    color: #333;
  }
  
  .notice p {
    margin: 8px 0;
    color: #666;
  }
  
  .notice button {
    padding: 10px 20px;
    margin-top: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
  }
  
  .notice button:not(:disabled) {
    background: #667eea;
    color: white;
  }
  
  .notice button:not(:disabled):hover {
    background: #5568d3;
  }
  
  .notice button:disabled {
    background: #ccc;
    color: #666;
    cursor: not-allowed;
  }
  
  .delete-btn {
    background: #ff6b6b !important;
    color: white !important;
    margin-left: 10px;
  }
  
  .delete-btn:hover {
    background: #fa5252 !important;
  }
  
  details {
    margin-top: 10px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 5px;
  }
  
  summary {
    cursor: pointer;
    font-weight: bold;
    color: #667eea;
  }
  
  .submitter-list {
    margin-top: 10px;
    padding-left: 20px;
  }
  
  .deadline-passed {
    border-left-color: #ff6b6b;
  }
  
  .deadline-soon {
    border-left-color: #ffa500;
  }
  
  .status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
    margin-left: 10px;
  }
  
  .badge-completed {
    background: #d4edda;
    color: #155724;
  }
  
  .badge-pending {
    background: #fff3cd;
    color: #856404;
  }
  
  .badge-closed {
    background: #f8d7da;
    color: #721c24;
  }
</style>
</head>
<body>
<div class="header">
  <h2>ğŸ“¢ ê³¼ì œ ê³µì§€</h2>
  <a href="index.html">â† í™ˆ</a>
</div>

<!-- ì„ ìƒë‹˜ ì „ìš© -->
<div id="teacherBox"></div>
<div id="workArea"></div>

<script>
const ROLE = localStorage.getItem("role");
const USER = localStorage.getItem("user");
const CLASS = localStorage.getItem("class");

if (!ROLE) {
  alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  location.href = "index.html";
}

let works = JSON.parse(localStorage.getItem("works")) || [];

function addWork() {
  const title = document.getElementById("title").value;
  const content = document.getElementById("content").value;
  const deadline = document.getElementById("deadline").value;
  const targetClass = document.getElementById("targetClass").value;
  
  if (!title || !content || !deadline) {
    alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }
  
  works.push({
    id: Date.now(),
    title: title,
    content: content,
    deadline: deadline,
    class: targetClass,
    createdBy: USER
  });
  
  localStorage.setItem("works", JSON.stringify(works));
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  document.getElementById("title").value = "";
  document.getElementById("content").value = "";
  document.getElementById("deadline").value = "";
  
  render();
}

function deleteWork(id) {
  if (confirm("ì •ë§ ì´ ê³¼ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    works = works.filter(w => w.id !== id);
    localStorage.setItem("works", JSON.stringify(works));
    // ì œì¶œ ë°ì´í„°ë„ ì‚­ì œ
    localStorage.removeItem("submit_" + id);
    render();
  }
}

function submit(id) {
  const key = "submit_" + id;
  let list = JSON.parse(localStorage.getItem(key)) || [];
  
  if (!list.includes(USER)) {
    list.push(USER);
    localStorage.setItem(key, JSON.stringify(list));
    alert("ê³¼ì œê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!");
    render();
  }
}

function getDeadlineStatus(deadline) {
  const today = new Date().toISOString().slice(0, 10);
  const deadlineDate = new Date(deadline);
  const todayDate = new Date(today);
  const diffDays = Math.ceil((deadlineDate - todayDate) / (1000 * 60 * 60 * 24));
  
  if (diffDays < 0) return "passed";
  if (diffDays <= 2) return "soon";
  return "normal";
}

function render() {
  const workArea = document.getElementById("workArea");
  const teacherBox = document.getElementById("teacherBox");
  
  workArea.innerHTML = "";
  teacherBox.innerHTML = "";
  
  // ì„ ìƒë‹˜ UI
  if (ROLE === "teacher") {
    teacherBox.innerHTML = `
      <h3>ğŸ“ ê³¼ì œ ì¶”ê°€</h3>
      <input id="title" placeholder="ê³¼ì œ ì œëª© (ì˜ˆ: ìˆ˜í•™ ë¬¸ì œì§‘ p.45-50)">
      <input id="content" placeholder="ê³¼ì œ ë‚´ìš© ë° ì„¤ëª…">
      <input id="deadline" type="date">
      <select id="targetClass">
        <option value="1">1ë°˜</option>
        <option value="2">2ë°˜</option>
        <option value="3">3ë°˜</option>
        <option value="4">4ë°˜</option>
      </select>
      <button onclick="addWork()">ê³¼ì œ ì¶”ê°€</button>
    `;
  }
  
  // ë‚´ ë°˜ ê³¼ì œë§Œ í•„í„°ë§
  const myWorks = ROLE === "teacher" 
    ? works 
    : works.filter(w => w.class === CLASS);
  
  if (myWorks.length === 0) {
    workArea.innerHTML = `
      <div class="notice">
        <p style="text-align: center; color: #999;">ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
    `;
    return;
  }
  
  myWorks.forEach(w => {
    const key = "submit_" + w.id;
    let list = JSON.parse(localStorage.getItem(key)) || [];
    const submitted = list.includes(USER);
    const today = new Date().toISOString().slice(0, 10);
    const closed = today > w.deadline;
    const deadlineStatus = getDeadlineStatus(w.deadline);
    
    let statusClass = "";
    if (deadlineStatus === "passed") statusClass = "deadline-passed";
    else if (deadlineStatus === "soon") statusClass = "deadline-soon";
    
    let badge = "";
    if (ROLE === "student") {
      if (submitted) {
        badge = '<span class="status-badge badge-completed">âœ… ì œì¶œ ì™„ë£Œ</span>';
      } else if (closed) {
        badge = '<span class="status-badge badge-closed">âŒ ë§ˆê°</span>';
      } else {
        badge = '<span class="status-badge badge-pending">â³ ë¯¸ì œì¶œ</span>';
      }
    }
    
    const classInfo = ROLE === "teacher" ? `<p>ëŒ€ìƒ: ${w.class}ë°˜</p>` : "";
    
    workArea.innerHTML += `
      <div class="notice ${statusClass}">
        <h3>${w.title}${badge}</h3>
        ${classInfo}
        <p>${w.content}</p>
        <p>ğŸ“… ë§ˆê°: ${w.deadline}${closed ? " (ë§ˆê°ë¨)" : ""}</p>
        <p>ğŸ“Š ì œì¶œ: ${list.length}ëª…</p>
        ${ROLE === "student" ? `
          <button onclick="submit(${w.id})"
            ${submitted || closed ? "disabled" : ""}>
            ${submitted ? "ì œì¶œ ì™„ë£Œ" : closed ? "ë§ˆê°ë¨" : "ì œì¶œí•˜ê¸°"}
          </button>
        ` : `
          <details>
            <summary>ì œì¶œì ëª…ë‹¨ ë³´ê¸° (${list.length}ëª…)</summary>
            <div class="submitter-list">
              ${list.length > 0 ? list.map(n => `<p>âœ“ ${n}</p>`).join("") : "<p>ì•„ì§ ì œì¶œìê°€ ì—†ìŠµë‹ˆë‹¤.</p>"}
            </div>
          </details>
          <button class="delete-btn" onclick="deleteWork(${w.id})">ì‚­ì œ</button>
        `}
      </div>
    `;
  });
}

render();
</script>
</body>
</html>
