<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê³¼ì œ ê³µì§€</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: #f5f7fb;
  padding: 20px;
}

h2 {
  color: #333;
  margin-bottom: 10px;
}

a {
  text-decoration: none;
  color: #4a5bdc;
  font-weight: 600;
  margin-bottom: 20px;
  display: inline-block;
}

/* ì„ ìƒë‹˜ ê³¼ì œ ì¶”ê°€ ì˜ì—­ */
#teacherBox {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  margin-bottom: 20px;
}

#teacherBox h3 {
  color: #4a5bdc;
  margin-bottom: 15px;
}

#teacherBox input {
  width: calc(100% - 20px);
  padding: 10px;
  margin-bottom: 10px;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-size: 14px;
}

#teacherBox button {
  padding: 10px 20px;
  background: #4a5bdc;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: 600;
}

#teacherBox button:hover {
  background: #3849c7;
}

/* ê³¼ì œ ì¹´ë“œ */
.notice {
  background: white;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  border-left: 5px solid #4a5bdc;
}

.notice h3 {
  color: #333;
  margin-bottom: 10px;
}

.notice p {
  color: #666;
  margin: 5px 0;
  line-height: 1.6;
}

.notice .deadline {
  color: #ff5252;
  font-weight: 600;
}

.notice .submit-count {
  color: #4a5bdc;
  font-weight: 600;
}

.notice button {
  margin-top: 10px;
  padding: 8px 16px;
  background: #4a5bdc;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: 600;
}

.notice button:hover {
  background: #3849c7;
}

.notice button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.notice details {
  margin-top: 10px;
  padding: 10px;
  background: #f8f9fa;
  border-radius: 5px;
}

.notice summary {
  cursor: pointer;
  font-weight: 600;
  color: #4a5bdc;
}

.notice .student-list {
  margin-top: 10px;
  padding-left: 20px;
}

.notice .student-list div {
  padding: 3px 0;
  color: #666;
}

.delete-btn {
  background: #ff6b6b !important;
  margin-left: 10px;
}

.delete-btn:hover {
  background: #ff5252 !important;
}
</style>
</head>
<body>

<h2>ğŸ“¢ ê³¼ì œ ê³µì§€</h2>
<a href="index.html">â† í™ˆìœ¼ë¡œ</a>

<!-- ì„ ìƒë‹˜ ì „ìš© ê³¼ì œ ì¶”ê°€ ì˜ì—­ -->
<div id="teacherBox"></div>

<!-- ê³¼ì œ ëª©ë¡ -->
<div id="workArea"></div>

<script>
/* === ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° === */
const loginUser = JSON.parse(localStorage.getItem("loginUser"));

// ë¡œê·¸ì¸ ì•ˆ í–ˆìœ¼ë©´ í™ˆìœ¼ë¡œ ì´ë™
if(!loginUser) {
  alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");
  location.href = "index.html";
}

const ROLE = loginUser.role; // "student" ë˜ëŠ” "teacher"
const USER = loginUser.code || loginUser.name; // í•™ìƒ: í•™ë²ˆ, ì„ ìƒë‹˜: ì´ë¦„

/* === ê³¼ì œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° === */
let works = JSON.parse(localStorage.getItem("works")) || [];

/* === ê³¼ì œ ì¶”ê°€ (ì„ ìƒë‹˜ë§Œ ê°€ëŠ¥) === */
function addWork(){
  const title = document.getElementById("title").value.trim();
  const content = document.getElementById("content").value.trim();
  const deadline = document.getElementById("deadline").value;
  
  if(!title || !content || !deadline){
    alert("ì œëª©, ë‚´ìš©, ë§ˆê°ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    return;
  }
  
  // ìƒˆ ê³¼ì œ ì¶”ê°€
  works.push({
    id: Date.now(),
    title: title,
    content: content,
    deadline: deadline
  });
  
  localStorage.setItem("works", JSON.stringify(works));
  
  // ì…ë ¥ì°½ ì´ˆê¸°í™”
  document.getElementById("title").value = "";
  document.getElementById("content").value = "";
  document.getElementById("deadline").value = "";
  
  render();
}

/* === ê³¼ì œ ì‚­ì œ (ì„ ìƒë‹˜ë§Œ ê°€ëŠ¥) === */
function deleteWork(id){
  if(confirm("ì´ ê³¼ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
    works = works.filter(w => w.id !== id);
    localStorage.setItem("works", JSON.stringify(works));
    
    // ì œì¶œ ê¸°ë¡ë„ ì‚­ì œ
    localStorage.removeItem("submit_" + id);
    
    render();
  }
}

/* === ê³¼ì œ ì œì¶œ (í•™ìƒë§Œ ê°€ëŠ¥) === */
function submit(id){
  const key = "submit_" + id;
  let list = JSON.parse(localStorage.getItem(key)) || [];
  
  if(!list.includes(USER)){
    list.push(USER);
    localStorage.setItem(key, JSON.stringify(list));
    alert("ê³¼ì œë¥¼ ì œì¶œí–ˆìŠµë‹ˆë‹¤!");
    render();
  }
}

/* === í™”ë©´ ë Œë”ë§ === */
function render(){
  const teacherBox = document.getElementById("teacherBox");
  const workArea = document.getElementById("workArea");
  
  teacherBox.innerHTML = "";
  workArea.innerHTML = "";
  
  // ì„ ìƒë‹˜ì´ë©´ ê³¼ì œ ì¶”ê°€ ì˜ì—­ í‘œì‹œ
  if(ROLE === "teacher"){
    teacherBox.innerHTML = `
      <h3>âœï¸ ê³¼ì œ ì¶”ê°€</h3>
      <input id="title" type="text" placeholder="ê³¼ì œ ì œëª©">
      <input id="content" type="text" placeholder="ê³¼ì œ ë‚´ìš©">
      <input id="deadline" type="date">
      <button onclick="addWork()">ê³¼ì œ ì¶”ê°€</button>
    `;
  }
  
  // ê³¼ì œ ëª©ë¡ í‘œì‹œ
  if(works.length === 0){
    workArea.innerHTML = `
      <div style="text-align:center; padding:40px; color:#999;">
        ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.
      </div>
    `;
    return;
  }
  
  works.forEach(w => {
    const key = "submit_" + w.id;
    let list = JSON.parse(localStorage.getItem(key)) || [];
    const submitted = list.includes(USER); // ë‚´ê°€ ì œì¶œí–ˆëŠ”ì§€
    const today = new Date().toISOString().slice(0,10);
    const closed = today > w.deadline; // ë§ˆê° ì§€ë‚¬ëŠ”ì§€
    
    const noticeDiv = document.createElement("div");
    noticeDiv.className = "notice";
    
    let html = `
      <h3>${w.title}</h3>
      <p>${w.content}</p>
      <p class="deadline">ğŸ“… ë§ˆê°: ${w.deadline} ${closed ? "(ë§ˆê°ë¨)" : ""}</p>
      <p class="submit-count">ğŸ“ ì œì¶œ: ${list.length}/24ëª…</p>
    `;
    
    // í•™ìƒì´ë©´ ì œì¶œ ë²„íŠ¼
    if(ROLE === "student"){
      html += `
        <button onclick="submit(${w.id})" ${submitted || closed ? "disabled" : ""}>
          ${submitted ? "âœ… ì œì¶œ ì™„ë£Œ" : closed ? "âŒ ë§ˆê°ë¨" : "ğŸ“¤ ì œì¶œí•˜ê¸°"}
        </button>
      `;
    }
    
    // ì„ ìƒë‹˜ì´ë©´ ì œì¶œì ëª…ë‹¨ + ì‚­ì œ ë²„íŠ¼
    if(ROLE === "teacher"){
      html += `
        <details>
          <summary>ğŸ‘¥ ì œì¶œì ëª…ë‹¨ (${list.length}ëª…)</summary>
          <div class="student-list">
      `;
      
      if(list.length === 0){
        html += `<div style="color:#999;">ì•„ì§ ì œì¶œí•œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
      } else {
        list.forEach(student => {
          html += `<div>âœ“ ${student}</div>`;
        });
      }
      
      html += `
          </div>
        </details>
        <button class="delete-btn" onclick="deleteWork(${w.id})">ğŸ—‘ï¸ ì‚­ì œ</button>
      `;
    }
    
    noticeDiv.innerHTML = html;
    workArea.appendChild(noticeDiv);
  });
}

/* === ì´ˆê¸° ë Œë”ë§ === */
render();
</script>

</body>
</html>
