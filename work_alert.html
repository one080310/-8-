<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê³¼ì œ ê³µì§€</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
  background: #f5f7fb;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

h2 {
  color: #333;
  margin: 0;
}

a {
  text-decoration: none;
  color: #4a5bdc;
  font-weight: 600;
}

a:hover {
  color: #3849c7;
}

/* ì„ ìƒë‹˜ ê³¼ì œ ì¶”ê°€ ì˜ì—­ */
#teacherBox {
  background: white;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

#teacherBox h3 {
  margin-top: 0;
  color: #4a5bdc;
  margin-bottom: 15px;
}

#teacherBox input,
#teacherBox select {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border: 2px solid #e0e4ff;
  border-radius: 8px;
  font-size: 14px;
  box-sizing: border-box;
}

#teacherBox input:focus,
#teacherBox select:focus {
  outline: none;
  border-color: #4a5bdc;
}

#teacherBox button {
  width: 100%;
  padding: 12px;
  background: #4a5bdc;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  transition: background 0.3s;
}

#teacherBox button:hover {
  background: #3849c7;
}

/* ê³¼ì œ ì¹´ë“œ */
.notice {
  background: white;
  padding: 20px;
  margin-bottom: 15px;
  border-radius: 10px;
  border-left: 4px solid #4a5bdc;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  transition: transform 0.2s;
}

.notice:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.12);
}

.notice h3 {
  margin-top: 0;
  color: #333;
  display: flex;
  align-items: center;
  gap: 10px;
}

.notice p {
  margin: 8px 0;
  color: #666;
  line-height: 1.6;
}

.notice button {
  padding: 10px 20px;
  margin-top: 10px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  transition: all 0.3s;
}

.notice button:not(:disabled) {
  background: #4a5bdc;
  color: white;
}

.notice button:not(:disabled):hover {
  background: #3849c7;
  transform: scale(1.05);
}

.notice button:disabled {
  background: #ccc;
  color: #666;
  cursor: not-allowed;
}

.delete-btn {
  background: #ff6b6b !important;
  color: white !important;
  margin-left: 10px;
}

.delete-btn:hover {
  background: #ff5252 !important;
}

details {
  margin-top: 15px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 8px;
}

summary {
  cursor: pointer;
  font-weight: bold;
  color: #4a5bdc;
  padding: 5px;
}

summary:hover {
  color: #3849c7;
}

.submitter-list {
  margin-top: 10px;
  padding-left: 10px;
}

.submitter-list p {
  margin: 5px 0;
  color: #555;
}

/* ë§ˆê° ìƒíƒœë³„ ìŠ¤íƒ€ì¼ */
.deadline-passed {
  border-left-color: #ff6b6b;
}

.deadline-soon {
  border-left-color: #ffa500;
}

/* ìƒíƒœ ë±ƒì§€ */
.status-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: bold;
}

.badge-completed {
  background: #d4edda;
  color: #155724;
}

.badge-pending {
  background: #fff3cd;
  color: #856404;
}

.badge-closed {
  background: #f8d7da;
  color: #721c24;
}

/* ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.empty-state p {
  color: #999;
  font-size: 16px;
  margin: 10px 0;
}

.empty-state .emoji {
  font-size: 48px;
  margin-bottom: 10px;
}
</style>
</head>
<body>

<div class="header">
  <h2>ğŸ“¢ ê³¼ì œ ê³µì§€</h2>
  <a href="index.html">â† í™ˆìœ¼ë¡œ</a>
</div>

<!-- ì„ ìƒë‹˜ ì „ìš© ê³¼ì œ ì¶”ê°€ ì˜ì—­ -->
<div id="teacherBox"></div>

<!-- ê³¼ì œ ëª©ë¡ -->
<div id="workArea"></div>

<script>
/* === ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° === */
const loginUser = JSON.parse(localStorage.getItem("loginUser"));

// ë¡œê·¸ì¸ ì•ˆ í–ˆìœ¼ë©´ í™ˆìœ¼ë¡œ ì´ë™
if(!loginUser) {
  alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");
  location.href = "index.html";
}

const ROLE = loginUser.role; // "student" ë˜ëŠ” "teacher"
const USER = loginUser.code || loginUser.name; // í•™ìƒ: í•™ë²ˆ, ì„ ìƒë‹˜: ì´ë¦„
const CLASS = loginUser.classNum; // í•™ìƒì˜ ë°˜ ë²ˆí˜¸

/* === ê³¼ì œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° === */
let works = JSON.parse(localStorage.getItem("works")) || [];

/* === ê³¼ì œ ì¶”ê°€ (ì„ ìƒë‹˜ë§Œ ê°€ëŠ¥) === */
function addWork() {
  const title = document.getElementById("title").value.trim();
  const content = document.getElementById("content").value.trim();
  const deadline = document.getElementById("deadline").value;
  const targetClass = document.getElementById("targetClass").value;
  
  if (!title || !content || !deadline) {
    alert("ì œëª©, ë‚´ìš©, ë§ˆê°ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    return;
  }
  
  // ìƒˆ ê³¼ì œ ì¶”ê°€
  works.push({
    id: Date.now(),
    title: title,
    content: content,
    deadline: deadline,
    class: targetClass,
    createdBy: USER
  });
  
  localStorage.setItem("works", JSON.stringify(works));
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  document.getElementById("title").value = "";
  document.getElementById("content").value = "";
  document.getElementById("deadline").value = "";
  
  alert("ê³¼ì œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
  render();
}

/* === ê³¼ì œ ì‚­ì œ (ì„ ìƒë‹˜ë§Œ ê°€ëŠ¥) === */
function deleteWork(id) {
  if (confirm("ì •ë§ ì´ ê³¼ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    works = works.filter(w => w.id !== id);
    localStorage.setItem("works", JSON.stringify(works));
    
    // ì œì¶œ ë°ì´í„°ë„ ì‚­ì œ
    localStorage.removeItem("submit_" + id);
    
    alert("ê³¼ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
    render();
  }
}

/* === ê³¼ì œ ì œì¶œ (í•™ìƒë§Œ ê°€ëŠ¥) === */
function submit(id) {
  const key = "submit_" + id;
  let list = JSON.parse(localStorage.getItem(key)) || [];
  
  if (!list.includes(USER)) {
    list.push(USER);
    localStorage.setItem(key, JSON.stringify(list));
    alert("ê³¼ì œê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!");
    render();
  }
}

/* === ë§ˆê°ì¼ ìƒíƒœ í™•ì¸ === */
function getDeadlineStatus(deadline) {
  const today = new Date().toISOString().slice(0, 10);
  const deadlineDate = new Date(deadline);
  const todayDate = new Date(today);
  const diffDays = Math.ceil((deadlineDate - todayDate) / (1000 * 60 * 60 * 24));
  
  if (diffDays < 0) return "passed"; // ë§ˆê° ì§€ë‚¨
  if (diffDays <= 2) return "soon"; // ë§ˆê° ì„ë°•
  return "normal"; // ì •ìƒ
}

/* === í™”ë©´ ë Œë”ë§ === */
function render() {
  const workArea = document.getElementById("workArea");
  const teacherBox = document.getElementById("teacherBox");
  
  workArea.innerHTML = "";
  teacherBox.innerHTML = "";
  
  // ì„ ìƒë‹˜ì´ë©´ ê³¼ì œ ì¶”ê°€ ì˜ì—­ í‘œì‹œ
  if (ROLE === "teacher") {
    teacherBox.innerHTML = `
      <h3>ğŸ“ ê³¼ì œ ì¶”ê°€</h3>
      <input id="title" type="text" placeholder="ê³¼ì œ ì œëª© (ì˜ˆ: ìˆ˜í•™ ë¬¸ì œì§‘ p.45-50)">
      <input id="content" type="text" placeholder="ê³¼ì œ ë‚´ìš© ë° ì„¤ëª…">
      <input id="deadline" type="date">
      <select id="targetClass">
        <option value="1">1ë°˜</option>
        <option value="2">2ë°˜</option>
        <option value="3">3ë°˜</option>
        <option value="4">4ë°˜</option>
        <option value="5">5ë°˜</option>
        <option value="6">6ë°˜</option>
        <option value="7">7ë°˜</option>
      </select>
      <button onclick="addWork()">ê³¼ì œ ì¶”ê°€</button>
    `;
  }
  
  // ë‚´ ë°˜ ê³¼ì œë§Œ í•„í„°ë§ (ì„ ìƒë‹˜ì€ ëª¨ë“  ê³¼ì œ í‘œì‹œ)
  const myWorks = ROLE === "teacher" 
    ? works 
    : works.filter(w => w.class === CLASS);
  
  // ê³¼ì œê°€ ì—†ì„ ë•Œ (í•™ìƒë§Œ ë©”ì‹œì§€ í‘œì‹œ)
  if (myWorks.length === 0) {
    if (ROLE === "student") {
      workArea.innerHTML = `
        <div class="empty-state">
          <div class="emoji">ğŸ“­</div>
          <p>ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
          <p style="font-size:14px; color:#bbb;">ì„ ìƒë‹˜ì´ ê³¼ì œë¥¼ ë“±ë¡í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
        </div>
      `;
    }
    // ì„ ìƒë‹˜ì€ ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ ì•ˆ í•¨
    return;
  }
  
  // ê³¼ì œ ëª©ë¡ í‘œì‹œ
  myWorks.forEach(w => {
    const key = "submit_" + w.id;
    let list = JSON.parse(localStorage.getItem(key)) || [];
    const submitted = list.includes(USER); // ë‚´ê°€ ì œì¶œí–ˆëŠ”ì§€
    const today = new Date().toISOString().slice(0, 10);
    const closed = today > w.deadline; // ë§ˆê° ì§€ë‚¬ëŠ”ì§€
    const deadlineStatus = getDeadlineStatus(w.deadline);
    
    // ë§ˆê° ìƒíƒœë³„ í´ë˜ìŠ¤
    let statusClass = "";
    if (deadlineStatus === "passed") statusClass = "deadline-passed";
    else if (deadlineStatus === "soon") statusClass = "deadline-soon";
    
    // í•™ìƒìš© ìƒíƒœ ë±ƒì§€
    let badge = "";
    if (ROLE === "student") {
      if (submitted) {
        badge = '<span class="status-badge badge-completed">âœ… ì œì¶œ ì™„ë£Œ</span>';
      } else if (closed) {
        badge = '<span class="status-badge badge-closed">âŒ ë§ˆê°</span>';
      } else {
        badge = '<span class="status-badge badge-pending">â³ ë¯¸ì œì¶œ</span>';
      }
    }
    
    // ì„ ìƒë‹˜ìš© ë°˜ ì •ë³´
    const classInfo = ROLE === "teacher" ? `<p><strong>ëŒ€ìƒ:</strong> ${w.class}ë°˜</p>` : "";
    
    const noticeDiv = document.createElement("div");
    noticeDiv.className = `notice ${statusClass}`;
    
    let html = `
      <h3>${w.title}${badge}</h3>
      ${classInfo}
      <p>${w.content}</p>
      <p><strong>ğŸ“… ë§ˆê°:</strong> ${w.deadline}${closed ? " <span style='color:#ff5252;'>(ë§ˆê°ë¨)</span>" : ""}</p>
      <p><strong>ğŸ“Š ì œì¶œ:</strong> ${list.length}/24ëª…</p>
    `;
    
    // í•™ìƒì´ë©´ ì œì¶œ ë²„íŠ¼
    if (ROLE === "student") {
      html += `
        <button onclick="submit(${w.id})" ${submitted || closed ? "disabled" : ""}>
          ${submitted ? "âœ… ì œì¶œ ì™„ë£Œ" : closed ? "âŒ ë§ˆê°ë¨" : "ğŸ“¤ ì œì¶œí•˜ê¸°"}
        </button>
      `;
    }
    
    // ì„ ìƒë‹˜ì´ë©´ ì œì¶œì ëª…ë‹¨ + ì‚­ì œ ë²„íŠ¼
    if (ROLE === "teacher") {
      html += `
        <details>
          <summary>ğŸ‘¥ ì œì¶œì ëª…ë‹¨ ë³´ê¸° (${list.length}ëª…)</summary>
          <div class="submitter-list">
      `;
      
      if (list.length === 0) {
        html += `<p style="color:#999;">ì•„ì§ ì œì¶œí•œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
      } else {
        list.forEach(student => {
          html += `<p>âœ“ ${student}</p>`;
        });
      }
      
      html += `
          </div>
        </details>
        <button class="delete-btn" onclick="deleteWork(${w.id})">ğŸ—‘ï¸ ì‚­ì œ</button>
      `;
    }
    
    noticeDiv.innerHTML = html;
    workArea.appendChild(noticeDiv);
  });
}

/* === ì´ˆê¸° ë Œë”ë§ === */
render();
</script>

</body>
</html>
