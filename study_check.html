<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ììŠµ ì²´í¬ & ë°˜ë³„ ì°¸ì„ë¥  (í•™ë…„ë³„)</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: #f5f7fb;
  padding: 20px;
}

h2 { 
  margin-bottom: 10px;
  color: #333;
}

a {
  text-decoration: none;
  font-weight: 600;
  color: #4a5bdc;
  display: inline-block;
  margin-bottom: 15px;
}

/* í•™ë…„ ì„ íƒ ë²„íŠ¼ */
.grade-buttons {
  margin: 20px 0;
  display: flex;
  gap: 10px;
}

.grade-buttons button {
  padding: 10px 20px;
  border: none;
  border-radius: 25px;
  background: #e0e4ff;
  cursor: pointer;
  font-weight: 700;
  font-size: 16px;
  transition: all 0.3s;
}

.grade-buttons button:hover {
  background: #c5ccff;
  transform: scale(1.05);
}

.grade-buttons button.active {
  background: #4a5bdc;
  color: white;
}

/* ë°˜ ì„ íƒ ë²„íŠ¼ */
.class-buttons {
  margin: 15px 0;
}

.class-buttons button {
  margin: 4px;
  padding: 8px 16px;
  border: none;
  border-radius: 20px;
  background: #e0e4ff;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
}

.class-buttons button:hover {
  background: #c5ccff;
}

.class-buttons button.active {
  background: #4a5bdc;
  color: white;
}

/* ë‚ ì§œ ì„ íƒ */
.date-selector {
  margin: 15px 0;
  padding: 15px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.date-selector input[type="date"] {
  padding: 8px 12px;
  border: 2px solid #e0e4ff;
  border-radius: 8px;
  font-size: 14px;
  margin: 0 10px;
}

.date-selector input:focus {
  outline: none;
  border-color: #4a5bdc;
}

#weekInfo {
  margin-left: 15px;
  font-weight: 600;
  color: #4a5bdc;
  font-size: 16px;
}

/* í…Œì´ë¸” */
table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  margin-top: 15px;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

th, td {
  border: 1px solid #e0e4ff;
  padding: 10px;
  text-align: center;
  font-size: 13px;
}

thead {
  background: #4a5bdc;
  color: white;
}

tbody tr:nth-child(even) {
  background: #f8f9fa;
}

tbody tr:hover {
  background: #e8ecff;
}

td:first-child {
  font-weight: 600;
  color: #4a5bdc;
  background: #f0f2ff;
}

input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #4a5bdc;
}

hr { 
  margin: 40px 0;
  border: none;
  border-top: 2px solid #e0e4ff;
}

/* ì°¨íŠ¸ ì˜ì—­ */
.chart-container {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
  margin-top: 20px;
}

h3 {
  color: #333;
  margin-bottom: 15px;
}
</style>
</head>

<body>

<h2>ğŸ“˜ ììŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ (í•™ë…„ë³„ Â· ë‚ ì§œ ê¸°ì¤€)</h2>
<a href="index.html">â† í™ˆìœ¼ë¡œ</a>

<!-- í•™ë…„ ì„ íƒ -->
<div class="grade-buttons" id="gradeButtons"></div>

<!-- ë°˜ ì„ íƒ -->
<div class="class-buttons" id="classButtons"></div>

<!-- ë‚ ì§œ ì„ íƒ -->
<div class="date-selector">
  <strong>ğŸ“… ë‚ ì§œ ì„ íƒ:</strong>
  <input type="date" id="datePicker" onchange="render()">
  <span id="weekInfo"></span>
</div>

<table>
<thead>
<tr>
  <th rowspan="2">ë²ˆí˜¸</th>
  <th colspan="15">ììŠµ ì²´í¬</th>
</tr>
<tr>
  <th>ì›” 8</th><th>ì›” ì•¼1</th><th>ì›” ì•¼2</th>
  <th>í™” 8</th><th>í™” ì•¼1</th><th>í™” ì•¼2</th>
  <th>ìˆ˜ 8</th><th>ìˆ˜ ì•¼1</th><th>ìˆ˜ ì•¼2</th>
  <th>ëª© 8</th><th>ëª© ì•¼1</th><th>ëª© ì•¼2</th>
  <th>ê¸ˆ 8</th><th>ê¸ˆ ì•¼1</th><th>ê¸ˆ ì•¼2</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<hr>

<div class="chart-container">
  <h3>ğŸ“Š <span id="chartTitle">1í•™ë…„</span> ë°˜ë³„ ììŠµ ì°¸ì„ë¥  ë¹„êµ</h3>
  <canvas id="classChart" height="120"></canvas>
</div>

<script>
/* === ì „ì—­ ë³€ìˆ˜ === */
let currentGrade = 1; // í˜„ì¬ ì„ íƒëœ í•™ë…„ (1, 2, 3)
let currentClass = 1; // í˜„ì¬ ì„ íƒëœ ë°˜ (1~7)
let chart;

const tableBody = document.getElementById("tableBody");
const weekInfo = document.getElementById("weekInfo");
const chartTitle = document.getElementById("chartTitle");

/* === ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì • === */
document.getElementById("datePicker").value = 
  new Date().toISOString().split("T")[0];

/* === í•™ë…„ ë²„íŠ¼ ìƒì„± (1, 2, 3í•™ë…„) === */
const gradeButtons = document.getElementById("gradeButtons");
for(let g = 1; g <= 3; g++) {
  const btn = document.createElement("button");
  btn.textContent = g + "í•™ë…„";
  if(g === 1) btn.classList.add("active"); // 1í•™ë…„ ê¸°ë³¸ ì„ íƒ
  btn.onclick = () => {
    currentGrade = g;
    currentClass = 1; // ë°˜ ì´ˆê¸°í™”
    
    // ëª¨ë“  í•™ë…„ ë²„íŠ¼ ë¹„í™œì„±í™”
    document.querySelectorAll(".grade-buttons button")
      .forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    
    // ë°˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸
    updateClassButtons();
    render();
  };
  gradeButtons.appendChild(btn);
}

/* === ë°˜ ë²„íŠ¼ ìƒì„± í•¨ìˆ˜ (1~7ë°˜) === */
function updateClassButtons() {
  const classButtons = document.getElementById("classButtons");
  classButtons.innerHTML = ""; // ê¸°ì¡´ ë²„íŠ¼ ì œê±°
  
  for(let i = 1; i <= 7; i++) {
    const btn = document.createElement("button");
    btn.textContent = i + "ë°˜";
    if(i === currentClass) btn.classList.add("active"); // í˜„ì¬ ë°˜ í™œì„±í™”
    
    btn.onclick = () => {
      currentClass = i;
      document.querySelectorAll(".class-buttons button")
        .forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      render();
    };
    
    classButtons.appendChild(btn);
  }
}

/* === ë‚ ì§œ â†’ ì£¼ì°¨ ê³„ì‚° === */
function getWeekKey() {
  const date = new Date(document.getElementById("datePicker").value);
  const year = date.getFullYear();
  const month = date.getMonth();
  const first = new Date(year, month, 1);
  const week = Math.ceil((date.getDate() + first.getDay()) / 7);
  
  weekInfo.textContent = `${year}ë…„ ${month + 1}ì›” ${week}ì£¼ì°¨`;
  return `${year}-${month + 1}-week${week}`;
}

/* === ë°ì´í„° ê°€ì ¸ì˜¤ê¸° === */
function getData(grade = currentGrade, classNum = currentClass) {
  const key = `study_${grade}í•™ë…„_${classNum}ë°˜_${getWeekKey()}`;
  let data = JSON.parse(localStorage.getItem(key));
  
  if(!data) {
    data = [];
    for(let i = 1; i <= 24; i++) {
      data.push({
        number: i,
        checks: Array(15).fill(false)
      });
    }
    localStorage.setItem(key, JSON.stringify(data));
  }
  
  return data;
}

/* === ì²´í¬ë°•ìŠ¤ í† ê¸€ === */
function toggleCheck(s, c) {
  const key = `study_${currentGrade}í•™ë…„_${currentClass}ë°˜_${getWeekKey()}`;
  const data = getData();
  data[s].checks[c] = !data[s].checks[c];
  localStorage.setItem(key, JSON.stringify(data));
  render();
}

/* === í…Œì´ë¸” ë Œë”ë§ === */
function render() {
  const data = getData();
  tableBody.innerHTML = "";
  
  data.forEach((stu, s) => {
    const tr = document.createElement("tr");
    
    // ë²ˆí˜¸ ì…€
    const numberCell = document.createElement("td");
    numberCell.textContent = stu.number;
    tr.appendChild(numberCell);
    
    // 15ê°œ ì²´í¬ë°•ìŠ¤
    for(let c = 0; c < 15; c++) {
      const td = document.createElement("td");
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = stu.checks[c];
      
      // í´ë¡œì €ë¡œ ì¸ë±ìŠ¤ ìº¡ì²˜
      cb.onclick = (function(studentIndex, checkIndex) {
        return function() {
          toggleCheck(studentIndex, checkIndex);
        };
      })(s, c);
      
      td.appendChild(cb);
      tr.appendChild(td);
    }
    
    tableBody.appendChild(tr);
  });
  
  drawChart();
}

/* === ë°˜ë³„ ì°¸ì„ë¥  ê³„ì‚° === */
function classRate(grade, classNum) {
  const d = getData(grade, classNum);
  let total = 24 * 15; // 24ëª… Ã— 15êµì‹œ
  let checked = 0;
  
  d.forEach(s => {
    s.checks.forEach(x => {
      if(x) checked++;
    });
  });
  
  return Math.round((checked / total) * 100);
}

/* === ì°¨íŠ¸ ê·¸ë¦¬ê¸° === */
function drawChart() {
  const labels = [];
  const values = [];
  
  // í˜„ì¬ í•™ë…„ì˜ 1~7ë°˜ ë°ì´í„°
  for(let i = 1; i <= 7; i++) {
    labels.push(i + "ë°˜");
    values.push(classRate(currentGrade, i));
  }
  
  // ì°¨íŠ¸ ì œëª© ì—…ë°ì´íŠ¸
  chartTitle.textContent = `${currentGrade}í•™ë…„`;
  
  // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
  if(chart) chart.destroy();
  
  // ìƒˆ ì°¨íŠ¸ ìƒì„±
  chart = new Chart(document.getElementById("classChart"), {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        label: weekInfo.textContent + " ì°¸ì„ë¥  (%)",
        data: values,
        backgroundColor: "#4a5bdc"
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          max: 100
        }
      }
    }
  });
}

/* === ì´ˆê¸° ë Œë”ë§ === */
updateClassButtons();
render();
</script>

</body>
</html>
