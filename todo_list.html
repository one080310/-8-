<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íˆ¬ë‘ë¦¬ìŠ¤íŠ¸ (í•™ë…„ë³„ Â· ê°œì¸/ë°˜ë³„)</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: #f5f7fb;
  padding: 20px;
}

h2 { 
  margin-bottom: 8px;
  color: #333;
}

a {
  text-decoration: none;
  color: #4a5bdc;
  font-weight: 600;
}

/* ëª¨ë“œ ì„ íƒ íƒ­ */
.mode-tabs {
  display: flex;
  gap: 10px;
  margin: 20px 0;
}

.mode-tabs button {
  padding: 12px 24px;
  border: none;
  border-radius: 25px;
  background: #e0e4ff;
  cursor: pointer;
  font-weight: 700;
  font-size: 16px;
  transition: all 0.3s;
}

.mode-tabs button:hover {
  background: #c5ccff;
}

.mode-tabs button.active {
  background: #4a5bdc;
  color: white;
}

/* í•™ë…„ ì„ íƒ ë²„íŠ¼ */
.grade-buttons {
  display: flex;
  gap: 10px;
  margin: 15px 0;
}

.grade-buttons button {
  padding: 8px 18px;
  border: none;
  border-radius: 20px;
  background: #e0e4ff;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
}

.grade-buttons button:hover {
  background: #c5ccff;
}

.grade-buttons button.active {
  background: #4a5bdc;
  color: white;
}

/* ë‚ ì§œ ì„ íƒ ì˜ì—­ */
.date-bar {
  display: flex;
  align-items: center;
  gap: 15px;
  margin: 15px 0;
  padding: 15px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.date-bar button {
  padding: 8px 16px;
  font-size: 18px;
  border: none;
  background: #4a5bdc;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s;
}

.date-bar button:hover {
  background: #3849c7;
}

.date-bar strong {
  font-size: 20px;
  color: #333;
  min-width: 120px;
  text-align: center;
}

/* ë°˜ ì„ íƒ ë²„íŠ¼ */
.class-buttons button {
  margin: 4px;
  padding: 6px 14px;
  border: none;
  border-radius: 20px;
  background: #e0e4ff;
  cursor: pointer;
  font-weight: 600;
}

.class-buttons button.active {
  background: #4a5bdc;
  color: white;
}

/* ë°˜ë³„ íˆ¬ë‘ ì¶”ê°€ ì˜ì—­ (ì„ ìƒë‹˜ ì „ìš©) */
.class-todo-add {
  background: white;
  padding: 20px;
  border-radius: 10px;
  margin: 15px 0;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.class-todo-add h3 {
  color: #4a5bdc;
  margin-bottom: 10px;
}

.class-todo-add input {
  width: calc(100% - 100px);
  padding: 10px;
  border: 2px solid #e0e4ff;
  border-radius: 8px;
  font-size: 14px;
}

.class-todo-add button {
  padding: 10px 20px;
  background: #4a5bdc;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  margin-left: 10px;
}

/* ë°˜ë³„ íˆ¬ë‘ ì¹´ë“œ */
.class-todo-list {
  background: white;
  padding: 20px;
  border-radius: 10px;
  margin: 15px 0;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.class-todo-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px;
  margin: 8px 0;
  background: #f8f9fa;
  border-radius: 8px;
  border-left: 4px solid #4a5bdc;
}

.class-todo-item.completed {
  opacity: 0.6;
}

.class-todo-item input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  accent-color: #4a5bdc;
}

.class-todo-item span {
  flex: 1;
  font-size: 15px;
}

.class-todo-item.completed span {
  text-decoration: line-through;
}

.class-todo-item .completion {
  font-size: 12px;
  color: #666;
  font-weight: 600;
}

.class-todo-item button {
  background: #ff6b6b;
  border: none;
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

/* í•™ìƒ ì¹´ë“œ (ê°œì¸ íˆ¬ë‘) */
.student {
  background: white;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.06);
}

.student h3 {
  color: #4a5bdc;
  margin-bottom: 8px;
}

/* í•  ì¼ í•­ëª© */
.task {
  display: flex;
  align-items: center;
  gap: 6px;
  margin: 4px 0;
}

.task.done span {
  text-decoration: line-through;
  opacity: 0.6;
}

.task button {
  background: #ff6b6b;
  border: none;
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.task button:hover {
  background: #ff5252;
}

/* í•  ì¼ ì¶”ê°€ ì˜ì—­ */
.add-task {
  margin-top: 8px;
  display: flex;
  gap: 5px;
}

.add-task input {
  flex: 1;
  padding: 6px;
  border: 1px solid #ddd;
  border-radius: 5px;
}

.add-task button {
  padding: 6px 12px;
  background: #4a5bdc;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.add-task button:hover {
  background: #3849c7;
}
</style>
</head>
<body>

<h2>ğŸ“ íˆ¬ë‘ë¦¬ìŠ¤íŠ¸</h2>
<a href="index.html">â† í™ˆìœ¼ë¡œ</a>

<!-- ëª¨ë“œ ì„ íƒ (ê°œì¸/ë°˜ë³„) -->
<div class="mode-tabs">
  <button id="personalModeBtn" class="active" onclick="switchMode('personal')">
    ğŸ‘¤ ê°œì¸ íˆ¬ë‘ë¦¬ìŠ¤íŠ¸
  </button>
  <button id="classModeBtn" onclick="switchMode('class')">
    ğŸ“‹ ë°˜ë³„ íˆ¬ë‘ë¦¬ìŠ¤íŠ¸
  </button>
</div>

<!-- í•™ë…„ ì„ íƒ -->
<div class="grade-buttons" id="gradeButtons"></div>

<!-- ë‚ ì§œ ì„ íƒ -->
<div class="date-bar">
  <button onclick="changeDate(-1)">â—€</button>
  <strong id="dateText"></strong>
  <button onclick="changeDate(1)">â–¶</button>
</div>

<!-- ë°˜ ì„ íƒ -->
<div class="class-buttons" id="classButtons"></div>

<!-- ë°˜ë³„ íˆ¬ë‘ ì¶”ê°€ ì˜ì—­ (ì„ ìƒë‹˜ ì „ìš©) -->
<div class="class-todo-add" id="classTodoAdd" style="display:none;"></div>

<!-- ë°˜ë³„ íˆ¬ë‘ ëª©ë¡ -->
<div class="class-todo-list" id="classTodoList" style="display:none;"></div>

<!-- ê°œì¸ íˆ¬ë‘ ëª©ë¡ (í•™ìƒë³„) -->
<div id="studentArea"></div>

<script>
/* === ì‚¬ìš©ì ì •ë³´ === */
const loginUser = JSON.parse(localStorage.getItem("loginUser"));
if(!loginUser) {
  alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!");
  location.href = "index.html";
}

const ROLE = loginUser.role; // "student" ë˜ëŠ” "teacher"
const USER = loginUser.code || loginUser.name; // í•™ìƒ: í•™ë²ˆ, ì„ ìƒë‹˜: ì´ë¦„

/* === ì „ì—­ ë³€ìˆ˜ === */
let currentMode = "personal"; // "personal" ë˜ëŠ” "class"
let currentGrade = 1; // í˜„ì¬ í•™ë…„
let currentClass = 1; // í˜„ì¬ ë°˜
let currentDate = new Date(); // í˜„ì¬ ë‚ ì§œ

const studentArea = document.getElementById("studentArea");
const dateText = document.getElementById("dateText");

/* === ëª¨ë“œ ì „í™˜ === */
function switchMode(mode) {
  currentMode = mode;
  
  // ë²„íŠ¼ í™œì„±í™”
  document.getElementById("personalModeBtn").classList.toggle("active", mode === "personal");
  document.getElementById("classModeBtn").classList.toggle("active", mode === "class");
  
  render();
}

/* === ë‚ ì§œ í¬ë§· === */
function formatDate(d) {
  const year = d.getFullYear();
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const day = String(d.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
}

/* === ë‚ ì§œ í‘œì‹œ === */
function showDate() {
  const month = currentDate.getMonth() + 1;
  const day = currentDate.getDate();
  dateText.innerText = `${month}ì›” ${day}ì¼`;
}

/* === ë‚ ì§œ ë³€ê²½ === */
function changeDate(diff) {
  currentDate.setDate(currentDate.getDate() + diff);
  showDate();
  render();
}

/* === í•™ë…„ ë²„íŠ¼ ìƒì„± === */
const gradeButtons = document.getElementById("gradeButtons");
for(let g = 1; g <= 3; g++) {
  const btn = document.createElement("button");
  btn.textContent = g + "í•™ë…„";
  if(g === 1) btn.classList.add("active");
  btn.onclick = () => {
    currentGrade = g;
    currentClass = 1;
    document.querySelectorAll(".grade-buttons button")
      .forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    updateClassButtons();
    render();
  };
  gradeButtons.appendChild(btn);
}

/* === ë°˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸ === */
function updateClassButtons() {
  const classButtons = document.getElementById("classButtons");
  classButtons.innerHTML = "";
  
  for(let i = 1; i <= 7; i++) {
    const btn = document.createElement("button");
    btn.innerText = i + "ë°˜";
    if(i === currentClass) btn.classList.add("active");
    btn.onclick = () => {
      currentClass = i;
      document.querySelectorAll(".class-buttons button")
        .forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      render();
    };
    classButtons.appendChild(btn);
  }
}

/* === ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í‚¤ === */
function personalKey() {
  return `todo_personal_${currentGrade}í•™ë…„_${currentClass}ë°˜_${formatDate(currentDate)}`;
}

function classKey() {
  return `todo_class_${currentGrade}í•™ë…„_${currentClass}ë°˜_${formatDate(currentDate)}`;
}

/* === ê°œì¸ íˆ¬ë‘ ë°ì´í„° === */
function getPersonalData() {
  let data = JSON.parse(localStorage.getItem(personalKey()));
  if(!data) {
    data = [];
    for(let i = 1; i <= 24; i++) {
      data.push({number: i, tasks: []});
    }
    localStorage.setItem(personalKey(), JSON.stringify(data));
  }
  return data;
}

function savePersonalData(d) {
  localStorage.setItem(personalKey(), JSON.stringify(d));
}

/* === ë°˜ë³„ íˆ¬ë‘ ë°ì´í„° === */
function getClassData() {
  let data = JSON.parse(localStorage.getItem(classKey()));
  if(!data) data = [];
  return data;
}

function saveClassData(d) {
  localStorage.setItem(classKey(), JSON.stringify(d));
}

/* === ë°˜ë³„ íˆ¬ë‘ ì¶”ê°€ (ì„ ìƒë‹˜ë§Œ) === */
function addClassTodo() {
  const input = document.getElementById("classTodoInput");
  if(!input.value.trim()) return;
  
  const data = getClassData();
  data.push({
    id: Date.now(),
    text: input.value,
    completed: [] // ì™„ë£Œí•œ í•™ìƒ ëª©ë¡
  });
  
  saveClassData(data);
  input.value = "";
  render();
}

/* === ë°˜ë³„ íˆ¬ë‘ ì‚­ì œ (ì„ ìƒë‹˜ë§Œ) === */
function deleteClassTodo(id) {
  if(confirm("ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    const data = getClassData().filter(t => t.id !== id);
    saveClassData(data);
    render();
  }
}

/* === ë°˜ë³„ íˆ¬ë‘ ì²´í¬ (í•™ìƒ) === */
function toggleClassTodo(id) {
  const data = getClassData();
  const todo = data.find(t => t.id === id);
  if(!todo) return;
  
  const index = todo.completed.indexOf(USER);
  if(index === -1) {
    todo.completed.push(USER);
  } else {
    todo.completed.splice(index, 1);
  }
  
  saveClassData(data);
  render();
}

/* === ê°œì¸ íˆ¬ë‘ í•¨ìˆ˜ë“¤ === */
function addTask(sIndex, input) {
  if(!input.value.trim()) return;
  const d = getPersonalData();
  d[sIndex].tasks.push({text: input.value, done: false});
  savePersonalData(d);
  input.value = "";
  render();
}

function toggle(s, t) {
  const d = getPersonalData();
  d[s].tasks[t].done = !d[s].tasks[t].done;
  savePersonalData(d);
  render();
}

function removeTask(s, t) {
  const d = getPersonalData();
  d[s].tasks.splice(t, 1);
  savePersonalData(d);
  render();
}

/* === ë Œë”ë§ === */
function render() {
  if(currentMode === "personal") {
    renderPersonal();
  } else {
    renderClass();
  }
}

/* === ê°œì¸ íˆ¬ë‘ ë Œë”ë§ === */
function renderPersonal() {
  document.getElementById("classTodoAdd").style.display = "none";
  document.getElementById("classTodoList").style.display = "none";
  studentArea.style.display = "block";
  
  const d = getPersonalData();
  studentArea.innerHTML = "";

  d.forEach((stu, s) => {
    const box = document.createElement("div");
    box.className = "student";
    box.innerHTML = `<h3>${stu.number}ë²ˆ</h3>`;

    stu.tasks.forEach((task, t) => {
      const taskDiv = document.createElement("div");
      taskDiv.className = `task ${task.done ? "done" : ""}`;
      
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = task.done;
      checkbox.onclick = () => toggle(s, t);
      
      const span = document.createElement("span");
      span.textContent = task.text;
      
      const btn = document.createElement("button");
      btn.textContent = "X";
      btn.onclick = () => removeTask(s, t);
      
      taskDiv.appendChild(checkbox);
      taskDiv.appendChild(span);
      taskDiv.appendChild(btn);
      box.appendChild(taskDiv);
    });

    const addDiv = document.createElement("div");
    addDiv.className = "add-task";
    
    const input = document.createElement("input");
    input.placeholder = "í•  ì¼ ì¶”ê°€";
    input.onkeydown = (e) => {
      if(e.key === "Enter") addTask(s, input);
    };
    
    const addBtn = document.createElement("button");
    addBtn.textContent = "ì¶”ê°€";
    addBtn.onclick = () => addTask(s, input);
    
    addDiv.appendChild(input);
    addDiv.appendChild(addBtn);
    box.appendChild(addDiv);
    
    studentArea.appendChild(box);
  });
}

/* === ë°˜ë³„ íˆ¬ë‘ ë Œë”ë§ === */
function renderClass() {
  studentArea.style.display = "none";
  
  const classTodoAdd = document.getElementById("classTodoAdd");
  const classTodoList = document.getElementById("classTodoList");
  
  // ì„ ìƒë‹˜ì´ë©´ ì¶”ê°€ ì˜ì—­ í‘œì‹œ
  if(ROLE === "teacher") {
    classTodoAdd.style.display = "block";
    classTodoAdd.innerHTML = `
      <h3>âœï¸ ë°˜ ì „ì²´ í•  ì¼ ì¶”ê°€</h3>
      <input type="text" id="classTodoInput" placeholder="ë°˜ ì „ì²´ê°€ í•´ì•¼ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
      <button onclick="addClassTodo()">ì¶”ê°€</button>
    `;
  } else {
    classTodoAdd.style.display = "none";
  }
  
  // ë°˜ë³„ íˆ¬ë‘ ëª©ë¡ í‘œì‹œ
  classTodoList.style.display = "block";
  classTodoList.innerHTML = "<h3>ğŸ“‹ ë°˜ ì „ì²´ í•  ì¼ ëª©ë¡</h3>";
  
  const data = getClassData();
  
  if(data.length === 0) {
    classTodoList.innerHTML += `
      <p style="text-align:center; color:#999; padding:20px;">
        ë“±ë¡ëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.
      </p>
    `;
    return;
  }
  
  data.forEach(todo => {
    const div = document.createElement("div");
    div.className = "class-todo-item";
    
    const isCompleted = todo.completed.includes(USER);
    if(isCompleted) div.classList.add("completed");
    
    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = isCompleted;
    checkbox.onclick = () => toggleClassTodo(todo.id);
    
    const span = document.createElement("span");
    span.textContent = todo.text;
    
    const completion = document.createElement("span");
    completion.className = "completion";
    completion.textContent = `${todo.completed.length}/24ëª… ì™„ë£Œ`;
    
    div.appendChild(checkbox);
    div.appendChild(span);
    div.appendChild(completion);
    
    if(ROLE === "teacher") {
      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "ì‚­ì œ";
      deleteBtn.onclick = () => deleteClassTodo(todo.id);
      div.appendChild(deleteBtn);
    }
    
    classTodoList.appendChild(div);
  });
}

/* === ì´ˆê¸°í™” === */
updateClassButtons();
showDate();
render();
</script>

</body>
</html>
