<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë°˜ë³„ íˆ¬ë‘ë¦¬ìŠ¤íŠ¸</title>
<style>
body {
  font-family:Segoe UI, sans-serif;
  background:#f5f7fb;
  padding:20px;
}
.box {
  background:white;
  border-radius:14px;
  padding:20px;
  margin-bottom:20px;
}
.todo {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
}
.g1 { background:#e8f0ff; }
.g2 { background:#e8fff1; }
.g3 { background:#fff3e8; }
.checked {
  text-decoration:line-through;
  opacity:0.6;
}
.teacher-check { accent-color:#d9534f; }
.student-check { accent-color:#4a5bdc; }

button, select, input {
  padding:8px;
  margin:4px;
}
.filter button {
  font-weight:600;
}
.active {
  background:#4a5bdc;
  color:white;
}
</style>
</head>
<body>

<h2>ğŸ“‹ ë°˜ë³„ íˆ¬ë‘ë¦¬ìŠ¤íŠ¸</h2>
<a href="index.html">â† í™ˆ</a>

<!-- í•™ë…„ í•„í„° -->
<div class="box filter" id="gradeFilter"></div>

<!-- ì„ ìƒë‹˜ ì¶”ê°€ -->
<div class="box" id="teacherPanel" style="display:none;">
  <h3>ğŸ‘©â€ğŸ« íˆ¬ë‘ ì¶”ê°€</h3>
  í•™ë…„
  <select id="grade">
    <option value="1">1í•™ë…„</option>
    <option value="2">2í•™ë…„</option>
    <option value="3">3í•™ë…„</option>
  </select>
  ë°˜
  <select id="classNum">
    <option>1</option><option>2</option><option>3</option>
    <option>4</option><option>5</option><option>6</option><option>7</option>
  </select>
  <br>
  <input id="todoText" placeholder="í•  ì¼">
  <button onclick="addTodo()">ì¶”ê°€</button>
</div>

<div id="todoArea"></div>

<script>
const user = JSON.parse(localStorage.getItem("loginUser"));
if(!user){ alert("ë¡œê·¸ì¸ í•„ìš”"); location.href="index.html"; }

const todoArea = document.getElementById("todoArea");
const teacherPanel = document.getElementById("teacherPanel");
const filterBox = document.getElementById("gradeFilter");

let currentGrade = user.role==="student" ? user.grade : "all";

if(user.role==="teacher") teacherPanel.style.display="block";

/* í•™ë…„ í•„í„° UI */
function renderFilter(){
  if(user.role==="student"){
    filterBox.innerHTML = `<b>${user.grade}í•™ë…„ íˆ¬ë‘</b>`;
    return;
  }
  filterBox.innerHTML = `
    <button onclick="setGrade('all')" class="${currentGrade==='all'?'active':''}">ì „ì²´</button>
    <button onclick="setGrade('1')" class="${currentGrade==='1'?'active':''}">1í•™ë…„</button>
    <button onclick="setGrade('2')" class="${currentGrade==='2'?'active':''}">2í•™ë…„</button>
    <button onclick="setGrade('3')" class="${currentGrade==='3'?'active':''}">3í•™ë…„</button>
  `;
}

function setGrade(g){
  currentGrade=g;
  renderFilter();
  loadTodos();
}

/* íˆ¬ë‘ ë¡œë”© */
function loadTodos(){
  todoArea.innerHTML="";
  const todos = JSON.parse(localStorage.getItem("classTodos")) || [];

  todos.forEach((t,i)=>{
    if(user.role==="student"){
      if(t.grade!==user.grade || t.classNum!==user.classNum) return;
    } else {
      if(currentGrade!=="all" && t.grade!=currentGrade) return;
    }

    const div=document.createElement("div");
    div.className=`todo g${t.grade} ${t.teacherChecked?"checked":""}`;

    div.innerHTML=`
      <span><b>${t.grade}í•™ë…„ ${t.classNum}ë°˜</b> - ${t.text}</span>
      ${
        user.role==="teacher"
        ? `<input type="checkbox" class="teacher-check"
            ${t.teacherChecked?"checked":""}
            onchange="teacherCheck(${i})">`
        : `<input type="checkbox" class="student-check"
            ${t.studentChecked?"checked":""}
            onchange="studentCheck(${i})">`
      }
    `;
    todoArea.appendChild(div);
  });
}

/* ê¸°ëŠ¥ */
function addTodo(){
  const grade=parseInt(document.getElementById("grade").value);
  const classNum=parseInt(document.getElementById("classNum").value);
  const text=document.getElementById("todoText").value.trim();
  if(!text) return;

  const todos=JSON.parse(localStorage.getItem("classTodos"))||[];
  todos.push({ grade,classNum,text,studentChecked:false,teacherChecked:false });
  localStorage.setItem("classTodos",JSON.stringify(todos));
  document.getElementById("todoText").value="";
  loadTodos();
}

function studentCheck(i){
  const t=JSON.parse(localStorage.getItem("classTodos"));
  t[i].studentChecked=!t[i].studentChecked;
  localStorage.setItem("classTodos",JSON.stringify(t));
  loadTodos();
}

function teacherCheck(i){
  const t=JSON.parse(localStorage.getItem("classTodos"));
  t[i].teacherChecked=!t[i].teacherChecked;
  localStorage.setItem("classTodos",JSON.stringify(t));
  loadTodos();
}

renderFilter();
loadTodos();
</script>
</body>
</html>
