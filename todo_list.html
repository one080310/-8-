<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë°˜ë³„ íˆ¬ë‘ë¦¬ìŠ¤íŠ¸</title>
<style>
body {
  font-family: Segoe UI, sans-serif;
  background:#f5f7fb;
  padding:20px;
}
.box {
  background:white;
  padding:20px;
  border-radius:14px;
  margin-bottom:20px;
}
table {
  border-collapse:collapse;
  width:100%;
}
th, td {
  border:1px solid #ddd;
  padding:6px;
  text-align:center;
  font-size:13px;
}
th {
  background:#eef1ff;
}
.student {
  background:#fafafa;
  font-weight:600;
}
.teacher-check {
  accent-color:#d9534f;
}
.student-check {
  accent-color:#4a5bdc;
}
input[type=text] {
  padding:6px;
}
button {
  padding:6px 12px;
  margin-left:6px;
}
</style>
</head>
<body>

<h2>ğŸ“‹ ë°˜ë³„ íˆ¬ë‘ë¦¬ìŠ¤íŠ¸ (ì—‘ì…€í˜•)</h2>
<a href="index.html">â† í™ˆ</a>

<div class="box">
  <b>2í•™ë…„ 1ë°˜</b> <!-- ë‚˜ì¤‘ì— ìë™í™” ê°€ëŠ¥ -->
</div>

<!-- ì„ ìƒë‹˜: í•  ì¼ ì¶”ê°€ -->
<div class="box" id="teacherBox" style="display:none;">
  <input id="newTodo" placeholder="í•  ì¼ ì¶”ê°€">
  <button onclick="addTodo()">+ ì—´ ì¶”ê°€</button>
</div>

<div class="box">
  <table id="todoTable"></table>
</div>

<script>
const user = JSON.parse(localStorage.getItem("loginUser"));
if(!user){ alert("ë¡œê·¸ì¸ í•„ìš”"); location.href="index.html"; }

const grade = 2;
const classNum = 1;
const key = `tableTodo_${grade}_${classNum}`;

if(user.role==="teacher"){
  document.getElementById("teacherBox").style.display="block";
}

/* ê¸°ë³¸ ë°ì´í„° */
let data = JSON.parse(localStorage.getItem(key));
if(!data){
  data = {
    todos: [],
    students: Array.from({length:24},(_,i)=>({
      num:i+1,
      checks:[]
    }))
  };
  localStorage.setItem(key, JSON.stringify(data));
}

/* í…Œì´ë¸” ê·¸ë¦¬ê¸° */
function render(){
  const table = document.getElementById("todoTable");
  table.innerHTML="";

  // í—¤ë”
  let header = "<tr><th>ë²ˆí˜¸</th>";
  data.todos.forEach(t=> header+=`<th>${t}</th>`);
  header += "</tr>";
  table.innerHTML+=header;

  // í•™ìƒ í–‰ (1~24 ê³ ì •)
  data.students.forEach((s,si)=>{
    let row = `<tr><td class="student">${s.num}</td>`;
    data.todos.forEach((_,ti)=>{
      const checked = s.checks[ti] || false;
      row += `
        <td>
          <input type="checkbox"
            class="${user.role==='teacher'?'teacher-check':'student-check'}"
            ${checked?"checked":""}
            onchange="toggle(${si},${ti})">
        </td>`;
    });
    row+="</tr>";
    table.innerHTML+=row;
  });
}

/* í•  ì¼(ì—´) ì¶”ê°€ */
function addTodo(){
  const text=document.getElementById("newTodo").value.trim();
  if(!text) return;
  data.todos.push(text);
  data.students.forEach(s=>s.checks.push(false));
  save();
}

/* ì²´í¬ */
function toggle(si,ti){
  data.students[si].checks[ti]=!data.students[si].checks[ti];
  save();
}

function save(){
  localStorage.setItem(key, JSON.stringify(data));
  render();
}

render();
</script>
</body>
</html>
